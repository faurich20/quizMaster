<!-- templates/register.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - QuizPlatform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .register-container { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 500px; width: 100%; padding: 40px; }
        .register-header { text-align: center; margin-bottom: 30px; }
        .register-header h1 { color: #333; font-size: 2.5em; margin-bottom: 10px; }
        .register-header p { color: #666; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; color: #333; font-weight: bold; margin-bottom: 8px; }
        .form-group input { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1em; transition: border-color 0.3s ease; }
        .form-group input:focus { outline: none; border-color: #667eea; }
        .form-group input.error { border-color: #f5576c; }
        .error-message { color: #f5576c; font-size: 0.9em; margin-top: 5px; display: none; }
        .password-requirements { background: #f8f9fa; border-radius: 10px; padding: 15px; margin-top: 10px; font-size: 0.85em; }
        .password-requirements h4 { color: #333; margin-bottom: 10px; }
        .requirement { color: #999; margin: 5px 0; display: flex; align-items: center; }
        .requirement.valid { color: #4caf50; }
        .requirement::before { content: "‚úó"; margin-right: 8px; font-weight: bold; }
        .requirement.valid::before { content: "‚úì"; }
        .role-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .role-option { border: 2px solid #e0e0e0; border-radius: 10px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s ease; }
        .role-option:hover { border-color: #667eea; transform: translateY(-2px); }
        .role-option.selected { border-color: #667eea; background: #f0f4ff; }
        .role-option input { display: none; }
        .role-icon { font-size: 3em; margin-bottom: 10px; }
        .btn { width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px; font-size: 1.1em; border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .link-container { text-align: center; margin-top: 20px; }
        .link-container a { color: #667eea; text-decoration: none; font-weight: bold; }
        .link-container a:hover { text-decoration: underline; }
        .verification-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000; }
        .verification-modal.active { display: flex; }
        .verification-content { background: white; border-radius: 20px; padding: 40px; max-width: 400px; width: 90%; text-align: center; }
        .verification-content h2 { color: #333; margin-bottom: 15px; }
        .verification-content p { color: #666; margin-bottom: 20px; }
        .code-input { display: flex; justify-content: center; gap: 10px; margin: 20px 0; }
        .code-input input { width: 50px; height: 60px; text-align: center; font-size: 2em; border: 2px solid #e0e0e0; border-radius: 10px; }
        .code-input input:focus { outline: none; border-color: #667eea; }
        .alert { padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none; }
        .alert.show { display: block; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
    </style>
</head>
<body>
    <div class="register-container">
        <div class="register-header">
            <h1>üë§ Crear Cuenta</h1>
            <p>√önete a la plataforma de aprendizaje gamificado</p>
        </div>
        
        <div class="alert alert-error" id="alertError"></div>
        <div class="alert alert-success" id="alertSuccess"></div>
        
        <form id="registerForm">
            <div class="form-group">
                <label>Selecciona tu rol:</label>
                <div class="role-selector">
                    <div class="role-option" onclick="selectRole('student')">
                        <input type="radio" name="role" value="student" id="roleStudent">
                        <div class="role-icon">üë®‚Äçüéì</div>
                        <div>Estudiante</div>
                    </div>
                    <div class="role-option" onclick="selectRole('teacher')">
                        <input type="radio" name="role" value="teacher" id="roleTeacher">
                        <div class="role-icon">üë®‚Äçüè´</div>
                        <div>Profesor</div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="username">Nombre de usuario:</label>
                <input type="text" id="username" name="username" required>
                <div class="error-message" id="usernameError"></div>
            </div>
            
            <div class="form-group">
                <label for="email">Correo electr√≥nico:</label>
                <input type="email" id="email" name="email" required>
                <div class="error-message" id="emailError"></div>
            </div>
            
            <div class="form-group">
                <label for="password">Contrase√±a:</label>
                <input type="password" id="password" name="password" required>
                <div class="error-message" id="passwordError"></div>
                
                <div class="password-requirements">
                    <h4>Requisitos de contrase√±a:</h4>
                    <div class="requirement" id="req-length">M√≠nimo 8 caracteres</div>
                    <div class="requirement" id="req-uppercase">Al menos una may√∫scula</div>
                    <div class="requirement" id="req-lowercase">Al menos una min√∫scula</div>
                    <div class="requirement" id="req-number">Al menos un n√∫mero</div>
                    <div class="requirement" id="req-special">Al menos un car√°cter especial (!@#$%^&*)</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="confirmPassword">Confirmar contrase√±a:</label>
                <input type="password" id="confirmPassword" name="confirmPassword" required>
                <div class="error-message" id="confirmPasswordError"></div>
            </div>
            
            <button type="submit" class="btn" id="submitBtn">Registrarse</button>
        </form>
        
        <div class="link-container">
            <p>¬øYa tienes cuenta? <a href="/login">Iniciar Sesi√≥n</a></p>
            <p><a href="/">Volver al inicio</a></p>
        </div>
    </div>
    
    <!-- Modal de Verificaci√≥n -->
    <div class="verification-modal" id="verificationModal">
        <div class="verification-content">
            <h2>üìß Verifica tu correo</h2>
            <p>Hemos enviado un c√≥digo de 6 d√≠gitos a <strong id="verificationEmail"></strong></p>
            
            <div class="code-input">
                <input type="text" maxlength="1" class="code-digit" data-index="0">
                <input type="text" maxlength="1" class="code-digit" data-index="1">
                <input type="text" maxlength="1" class="code-digit" data-index="2">
                <input type="text" maxlength="1" class="code-digit" data-index="3">
                <input type="text" maxlength="1" class="code-digit" data-index="4">
                <input type="text" maxlength="1" class="code-digit" data-index="5">
            </div>
            
            <button class="btn" onclick="verifyCode()">Verificar</button>
            <div style="margin-top: 15px;">
                <a href="#" onclick="resendCode()" style="color: #667eea; text-decoration: none;">Reenviar c√≥digo</a>
            </div>
        </div>
    </div>
    
    <script>
        let selectedRole = null;
        let userEmail = '';
        function selectRole(role) { selectedRole = role; document.querySelectorAll('.role-option').forEach(opt => { opt.classList.remove('selected'); }); event.currentTarget.classList.add('selected'); document.getElementById('role' + (role === 'teacher' ? 'Teacher' : 'Student')).checked = true; }
        document.getElementById('password').addEventListener('input', function(e) { const password = e.target.value; document.getElementById('req-length').classList.toggle('valid', password.length >= 8); document.getElementById('req-uppercase').classList.toggle('valid', /[A-Z]/.test(password)); document.getElementById('req-lowercase').classList.toggle('valid', /[a-z]/.test(password)); document.getElementById('req-number').classList.toggle('valid', /[0-9]/.test(password)); document.getElementById('req-special').classList.toggle('valid', /[!@#$%^&*(),.?":{}|<>]/.test(password)); });
        const codeInputs = document.querySelectorAll('.code-digit'); codeInputs.forEach((input, index) => { input.addEventListener('input', function(e) { if (e.target.value.length === 1 && index < 5) { codeInputs[index + 1].focus(); } }); input.addEventListener('keydown', function(e) { if (e.key === 'Backspace' && !e.target.value && index > 0) { codeInputs[index - 1].focus(); } }); });
        document.getElementById('registerForm').addEventListener('submit', async function(e) { e.preventDefault(); if (!selectedRole) { showAlert('error', 'Por favor selecciona un rol'); return; } const username = document.getElementById('username').value; const email = document.getElementById('email').value; const password = document.getElementById('password').value; const confirmPassword = document.getElementById('confirmPassword').value; if (password !== confirmPassword) { showAlert('error', 'Las contrase√±as no coinciden'); return; } try { const response = await fetch('/register', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, email, password, is_teacher: selectedRole === 'teacher' }) }); const data = await response.json(); if (response.ok) { userEmail = email; document.getElementById('verificationEmail').textContent = email; document.getElementById('verificationModal').classList.add('active'); } else { showAlert('error', data.error || 'Error en el registro'); } } catch (error) { showAlert('error', 'Error de conexi√≥n'); } });
        async function verifyCode() { const code = Array.from(document.querySelectorAll('.code-digit')).map(input => input.value).join(''); if (code.length !== 6) { alert('Por favor ingresa el c√≥digo completo'); return; } try { const response = await fetch('/verify', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email: userEmail, code }) }); const data = await response.json(); if (response.ok) { alert('‚úÖ Cuenta verificada exitosamente'); window.location.href = '/login'; } else { alert('‚ùå ' + (data.error || 'C√≥digo inv√°lido')); } } catch (error) { alert('Error de conexi√≥n'); } }
        async function resendCode() { try { const response = await fetch('/resend_code', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email: userEmail }) }); const data = await response.json(); if (response.ok) { alert('‚úÖ C√≥digo reenviado'); } else { alert('‚ùå ' + (data.error || 'Error al reenviar')); } } catch (error) { alert('Error de conexi√≥n'); } }
        function showAlert(type, message) { const alertEl = type === 'error' ? document.getElementById('alertError') : document.getElementById('alertSuccess'); alertEl.textContent = message; alertEl.classList.add('show'); setTimeout(() => { alertEl.classList.remove('show'); }, 5000); }
    </script>
</body>
</html>
